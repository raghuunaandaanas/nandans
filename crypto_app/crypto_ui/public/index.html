<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crypto Traderscope - Delta India | B5 Factor</title>
  <!--
    =============================================================================
    CRYPTO DASHBOARD UI - Delta India Exchange
    =============================================================================
    REPLICATED FROM: node_ui/public/index.html (Shoonya Version)
    PURPOSE: Parallel crypto trading dashboard
    
    GIT TRACKING:
    - Created: 2026-02-13
    - Author: AI Assistant
    - Feature: Initial crypto dashboard UI
    - Status: New file - no modifications to existing codebase
    
    PORT: 8788 (Shoonya uses 8787)
    =============================================================================
  -->
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0e1a;
      color: #e2e8f0;
      font-size: 13px;
    }
    
    .header {
      background: linear-gradient(135deg, #1a1f2e 0%, #0f1419 100%);
      padding: 16px 24px;
      border-bottom: 1px solid #2d3748;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .header h1 {
      font-size: 20px;
      background: linear-gradient(90deg, #fbbf24, #f59e0b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .header .subtitle {
      font-size: 11px;
      color: #64748b;
      margin-top: 4px;
    }
    
    .time-display {
      text-align: right;
    }
    
    .time-display .time {
      font-size: 24px;
      font-weight: 600;
      color: #fbbf24;
    }
    
    .time-display .label {
      font-size: 10px;
      color: #64748b;
    }
    
    .controls {
      background: #111827;
      padding: 12px 24px;
      border-bottom: 1px solid #2d3748;
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .controls label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: #94a3b8;
    }
    
    .controls select, .controls input {
      background: #1e293b;
      border: 1px solid #334155;
      color: #e2e8f0;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
    }
    
    .controls select:focus, .controls input:focus {
      outline: none;
      border-color: #fbbf24;
    }
    
    .stats-bar {
      background: #0f1419;
      padding: 12px 24px;
      border-bottom: 1px solid #2d3748;
      display: flex;
      gap: 32px;
    }
    
    .stat-item {
      display: flex;
      flex-direction: column;
    }
    
    .stat-item .label {
      font-size: 10px;
      color: #64748b;
      text-transform: uppercase;
    }
    
    .stat-item .value {
      font-size: 16px;
      font-weight: 600;
      color: #fbbf24;
    }
    
    .table-container {
      padding: 16px 24px;
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    
    thead {
      position: sticky;
      top: 0;
      background: #1a1f2e;
    }
    
    th {
      padding: 12px 8px;
      text-align: left;
      font-weight: 600;
      color: #94a3b8;
      border-bottom: 2px solid #334155;
      white-space: nowrap;
    }
    
    td {
      padding: 10px 8px;
      border-bottom: 1px solid #1e293b;
      white-space: nowrap;
    }
    
    tr:hover {
      background: #1e293b;
    }
    
    /* Factor badges */
    .factor-badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
    }
    
    .factor-micro { background: #065f46; color: #6ee7b7; }
    .factor-mini { background: #92400e; color: #fcd34d; }
    .factor-mega { background: #7f1d1d; color: #fca5a5; }
    
    /* Trend indicators */
    .trend-up { color: #22c55e; }
    .trend-down { color: #ef4444; }
    .trend-flat { color: #64748b; }
    
    /* Zone badges */
    .zone-badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 10px;
    }
    
    .zone-support { background: #1e3a5f; color: #7dd3fc; }
    .zone-resistance { background: #7c2d12; color: #fdba74; }
    .zone-acceleration { background: #14532d; color: #86efac; }
    .zone-neutral { background: #374151; color: #d1d5db; }
    
    /* Signal badges */
    .signal-high { color: #22c55e; font-weight: 600; }
    .signal-medium { color: #fbbf24; }
    .signal-low { color: #64748b; }
    
    /* Price colors */
    .price-up { color: #22c55e; }
    .price-down { color: #ef4444; }
    
    /* Status indicators */
    .status-in-range { 
      display: inline-block;
      padding: 2px 8px;
      background: #14532d;
      color: #86efac;
      border-radius: 3px;
      font-size: 10px;
      font-weight: 600;
    }
    
    .status-out { 
      display: inline-block;
      padding: 2px 8px;
      background: #374151;
      color: #9ca3af;
      border-radius: 3px;
      font-size: 10px;
    }
  </style>
</head>
<body>
  <div class="header">
    <div>
      <h1>ðŸš€ Crypto Traderscope | Delta India</h1>
      <div class="subtitle">B5 Factor Strategy | 24/7 Crypto Markets</div>
    </div>
    <div class="time-display">
      <div class="time" id="utcTime">--:--:--</div>
      <div class="label">UTC | 24/7 Trading</div>
    </div>
  </div>

  <div class="controls">
    <label>
      Factor:
      <select id="factor">
        <option value="smart" selected>ðŸ§  Smart (Auto)</option>
        <option value="micro">micro 0.2611%</option>
        <option value="mini">mini 2.61%</option>
        <option value="mega">mega 26.11%</option>
      </select>
    </label>
    
    <label>
      Search:
      <input type="text" id="search" placeholder="BTC, ETH, etc." />
    </label>
    
    <label>
      <input type="checkbox" id="triggerOnly" checked />
      Only Trend Ranges (BU1-BU5)
    </label>
    
    <label>
      <input type="checkbox" id="inRangeOnly" />
      In Range Only
    </label>
  </div>

  <div class="stats-bar">
    <div class="stat-item">
      <span class="label">Total Symbols</span>
      <span class="value" id="totalSymbols">-</span>
    </div>
    <div class="stat-item">
      <span class="label">In Range (BU1-BU5)</span>
      <span class="value" id="inRangeCount">-</span>
    </div>
    <div class="stat-item">
      <span class="label">Active Factor</span>
      <span class="value" id="activeFactor">Smart</span>
    </div>
    <div class="stat-item">
      <span class="label">Last Update</span>
      <span class="value" id="lastUpdate">-</span>
    </div>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Symbol</th>
          <th>Factor</th>
          <th>LTP</th>
          <th>Close</th>
          <th>Trend</th>
          <th>Confirm</th>
          <th>R:R</th>
          <th>Status</th>
          <th>BU1</th>
          <th>BU3</th>
          <th>BU5</th>
          <th>BE5</th>
          <th>Zone</th>
          <th>Signal</th>
        </tr>
      </thead>
      <tbody id="rows">
        <tr><td colspan="14" style="text-align:center;padding:40px;color:#64748b;">Loading...</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    // =============================================================================
    // CRYPTO DASHBOARD JAVASCRIPT
    // =============================================================================
    
    const API_URL = '/api/dashboard';
    const REFRESH_INTERVAL = 2000; // 2 seconds
    
    // DOM elements
    const factorEl = document.getElementById('factor');
    const searchEl = document.getElementById('search');
    const triggerOnlyEl = document.getElementById('triggerOnly');
    const inRangeOnlyEl = document.getElementById('inRangeOnly');
    const rowsEl = document.getElementById('rows');
    
    // Stats elements
    const totalSymbolsEl = document.getElementById('totalSymbols');
    const inRangeCountEl = document.getElementById('inRangeCount');
    const activeFactorEl = document.getElementById('activeFactor');
    const lastUpdateEl = document.getElementById('lastUpdate');
    
    // Formatters
    const f2 = (n) => Number(n).toFixed(2);
    const f4 = (n) => Number(n).toFixed(4);
    
    // Update UTC time
    function updateTime() {
      const now = new Date();
      document.getElementById('utcTime').textContent = now.toISOString().substr(11, 8);
    }
    setInterval(updateTime, 1000);
    updateTime();
    
    // Render factor badge
    function factorBadge(factor) {
      if (!factor) return '-';
      return `<span class="factor-badge factor-${factor}">${factor.toUpperCase()}</span>`;
    }
    
    // Render trend
    function renderTrend(trend) {
      if (!trend) return '-';
      const cls = trend === 'UP' ? 'trend-up' : trend === 'DOWN' ? 'trend-down' : 'trend-flat';
      return `<span class="${cls}">${trend}</span>`;
    }
    
    // Render zone badge
    function zoneBadge(zone) {
      if (!zone) return '-';
      const typeMap = {
        'support': 'zone-support',
        'resistance': 'zone-resistance',
        'acceleration': 'zone-acceleration',
        'neutral': 'zone-neutral',
      };
      const cls = typeMap[zone.type] || 'zone-neutral';
      return `<span class="zone-badge ${cls}">${zone.name || '-'}</span>`;
    }
    
    // Render signal
    function renderSignal(signal) {
      if (!signal) return '-';
      const cls = signal.strength === 'HIGH' ? 'signal-high' : 
                  signal.strength === 'MEDIUM' ? 'signal-medium' : 'signal-low';
      return `<span class="${cls}">${signal.strength || '-'}</span>`;
    }
    
    // Render status
    function renderStatus(inRange) {
      return inRange 
        ? '<span class="status-in-range">IN RANGE</span>'
        : '<span class="status-out">OUT</span>';
    }
    
    // Filter rows
    function filterRows(rows) {
      const q = searchEl.value.toLowerCase();
      const inRangeOnly = inRangeOnlyEl.checked;
      
      return rows.filter(r => {
        if (q && !r.symbol?.toLowerCase().includes(q)) return false;
        if (inRangeOnly && !r.in_range_up) return false;
        return true;
      });
    }
    
    // Render table
    function renderTable(rows) {
      if (!rows || rows.length === 0) {
        rowsEl.innerHTML = '<tr><td colspan="14" style="text-align:center;padding:40px;color:#64748b;">No data available</td></tr>';
        return;
      }
      
      rowsEl.innerHTML = rows.map(r => `
        <tr>
          <td><strong>${r.symbol}</strong></td>
          <td>${factorBadge(r.selected_factor)}</td>
          <td class="${r.ltp > r.close ? 'price-up' : 'price-down'}">${f2(r.ltp)}</td>
          <td>${f2(r.close)}</td>
          <td>${renderTrend(r.trend)}</td>
          <td>${r.confirmation ?? 0}</td>
          <td>${f2(r.rr_to_bu5)}</td>
          <td>${renderStatus(r.in_range_up)}</td>
          <td>${f2(r.bu1)}</td>
          <td>${f2(r.bu3)}</td>
          <td>${f2(r.bu5)}</td>
          <td>${f2(r.be5)}</td>
          <td>${zoneBadge(r.micro_zone)}</td>
          <td>${renderSignal(r.primary_signal)}</td>
        </tr>
      `).join('');
    }
    
    // Update stats
    function updateStats(data) {
      totalSymbolsEl.textContent = data.stats?.total_symbols || 0;
      inRangeCountEl.textContent = data.stats?.in_range_count || 0;
      activeFactorEl.textContent = data.config?.factor === 'smart' ? 'Smart' : data.config?.factor?.toUpperCase();
      lastUpdateEl.textContent = new Date().toLocaleTimeString();
    }
    
    // Fetch data
    async function fetchData() {
      try {
        const factor = factorEl.value;
        const triggerOnly = triggerOnlyEl.checked ? '1' : '0';
        
        const res = await fetch(`${API_URL}?factor=${factor}&trigger_only=${triggerOnly}&limit=100`);
        const data = await res.json();
        
        updateStats(data);
        
        const filtered = filterRows(data.rows || []);
        renderTable(filtered);
        
      } catch (err) {
        console.error('Fetch error:', err);
      }
    }
    
    // Event listeners
    factorEl.addEventListener('change', fetchData);
    searchEl.addEventListener('input', fetchData);
    triggerOnlyEl.addEventListener('change', fetchData);
    inRangeOnlyEl.addEventListener('change', fetchData);
    
    // Auto refresh
    setInterval(fetchData, REFRESH_INTERVAL);
    
    // Initial load
    fetchData();
  </script>
</body>
</html>
